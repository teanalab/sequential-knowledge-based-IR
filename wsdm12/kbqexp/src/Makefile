# -*- Makefile -*-

BIN_DIR=$(PROJ_DIR)/bin
OBJ_DIR=$(PROJ_DIR)/_obj
SRC_DIR=$(PROJ_DIR)/src

BUILD_MODE=debug

ifeq "$(BUILD_MODE)" "debug"
CCOPT=-g -gstabs+3 -D_DEBUG
endif

ifeq "$(BUILD_MODE)" "release"
CCOPT=-O3
endif

$(OBJ_DIR)/%.o: $(SRC_DIR)/%.cpp
	$(CXX) $(CXXFLAGS) -o $@ -c $<
	
prefix = /usr
exec_prefix = ${prefix}
INC = ${prefix}/include

LIBPATH = ${exec_prefix}/lib
CXX = g++
CFLAGS = -DPACKAGE_NAME=\"Lemur\" -DPACKAGE_TARNAME=\"lemur\" -DPACKAGE_VERSION=\"4.11\" -DPACKAGE_STRING=\"Lemur\ 4.11\" -DPACKAGE_BUGREPORT=\"project@lemurproject.org\" -DHAVE_LIBM=1 -DHAVE_LIBPTHREAD=1 -DHAVE_LIBZ=1 -DHAVE_NAMESPACES= -DISNAN_IN_NAMESPACE_STD= -DSTDC_HEADERS=1 -DHAVE_SYS_TYPES_H=1 -DHAVE_SYS_STAT_H=1 -DHAVE_STDLIB_H=1 -DHAVE_STRING_H=1 -DHAVE_MEMORY_H=1 -DHAVE_STRINGS_H=1 -DHAVE_INTTYPES_H=1 -DHAVE_STDINT_H=1 -DHAVE_UNISTD_H=1 -D_FILE_OFFSET_BITS=64 -DHAVE_FSEEKO=1 -DHAVE_MKSTEMP=1 -DHAVE_EXT_ATOMICITY_H=1 -DP_NEEDS_GNU_CXX_NAMESPACE=1 $(CCOPT)  -I$(INC)
CXXFLAGS = -DPACKAGE_NAME=\"Lemur\" -DPACKAGE_TARNAME=\"lemur\" -DPACKAGE_VERSION=\"4.11\" -DPACKAGE_STRING=\"Lemur\ 4.11\" -DPACKAGE_BUGREPORT=\"project@lemurproject.org\" -DHAVE_LIBM=1 -DHAVE_LIBPTHREAD=1 -DHAVE_LIBZ=1 -DHAVE_NAMESPACES= -DISNAN_IN_NAMESPACE_STD= -DSTDC_HEADERS=1 -DHAVE_SYS_TYPES_H=1 -DHAVE_SYS_STAT_H=1 -DHAVE_STDLIB_H=1 -DHAVE_STRING_H=1 -DHAVE_MEMORY_H=1 -DHAVE_STRINGS_H=1 -DHAVE_INTTYPES_H=1 -DHAVE_STDINT_H=1 -DHAVE_UNISTD_H=1 -D_FILE_OFFSET_BITS=64 -DHAVE_FSEEKO=1 -DHAVE_MKSTEMP=1 -DHAVE_EXT_ATOMICITY_H=1 -DP_NEEDS_GNU_CXX_NAMESPACE=1 $(CCOPT) -I$(INC)

CXXFLAGS += `xmlrpc-c-config c++ libwww-client --cflags`
CXXLIBS = `xmlrpc-c-config c++ libwww-client --libs`
CXXLIBS += -L$(LIBPATH) -llemur -lz -lpthread -lm

STR_UTILS = $(OBJ_DIR)/StrUtils.o
CON_UTILS = $(OBJ_DIR)/ConUtils.o
GRAPH_UTILS = $(OBJ_DIR)/ConceptGraphUtils.o
CN_CLIENT = $(OBJ_DIR)/ConceptNetClient.o
CON_GRAPH = $(OBJ_DIR)/ConceptGraph.o
TERM_GRAPH = $(OBJ_DIR)/TermGraph.o
QEXP_SIM = $(OBJ_DIR)/ConceptQExpSim.o
QEXP_UB = $(OBJ_DIR)/ConceptQExpUB.o
QUERY_GRAPH = $(OBJ_DIR)/QueryConGraph.o
CON_QEXP = $(OBJ_DIR)/ConceptQExp.o
NEG_FB = $(OBJ_DIR)/ConceptNegFB.o
GRAPH_TEST = $(OBJ_DIR)/ConGraphTest.o
FEAT_EXT = $(OBJ_DIR)/FeatExt.o
RET_NOTOP = $(OBJ_DIR)/RetNoTop.o
RANK_EXP = $(OBJ_DIR)/ConceptRankExp.o
CON_PF = $(OBJ_DIR)/ConceptPseudoFB.o

QEXP_SIM_OBJS = $(STR_UTILS) $(CN_CLIENT) $(TERM_GRAPH) $(QEXP_SIM)
QEXP_UB_OBJS = $(STR_UTILS) $(CON_UTILS) $(GRAPH_UTILS) $(CON_GRAPH) $(QEXP_UB)
QUERY_GRAPH_OBJS = $(STR_UTILS) $(CON_UTILS) $(GRAPH_UTILS) $(CN_CLIENT) $(CON_GRAPH) $(QUERY_GRAPH)
CON_QEXP_OBJS = $(STR_UTILS) $(CON_UTILS) $(GRAPH_UTILS) $(CON_GRAPH) $(TERM_GRAPH) $(CON_QEXP)
NEG_FB_OBJS = $(STR_UTILS) $(CON_UTILS) $(GRAPH_UTILS) $(CON_GRAPH) $(TERM_GRAPH) $(NEG_FB)
FEAT_EXT_OBJS = $(STR_UTILS) $(CON_UTILS) $(GRAPH_UTILS) $(CON_GRAPH) $(TERM_GRAPH) $(FEAT_EXT)
RANK_EXP_OBJS = $(STR_UTILS) $(CON_UTILS) $(RANK_EXP)
RET_NOTOP_OBJS = $(RET_NOTOP)
CON_PF_OBJS = $(STR_UTILS) $(CON_UTILS) $(CON_PF)
GRAPH_TEST_OBJS = $(STR_UTILS) $(GRAPH_TEST) $(CON_GRAPH) 

QEXP_SIM_BIN = $(BIN_DIR)/ConceptQExpSim
QEXP_UB_BIN = $(BIN_DIR)/ConceptQExpUB
QUERY_GRAPH_BIN = $(BIN_DIR)/QueryConGraph
CON_QEXP_BIN = $(BIN_DIR)/ConceptQExp
NEG_FB_BIN = $(BIN_DIR)/ConceptNegFB
FEAT_EXT_BIN = $(BIN_DIR)/FeatExt
RANK_EXP_BIN = $(BIN_DIR)/ConceptRankExp
RET_NOTOP_BIN = $(BIN_DIR)/RetNoTop
CON_PF_BIN = $(BIN_DIR)/ConceptPseudoFB
GRAPH_TEST_BIN = $(BIN_DIR)/ConGraphTest

all: $(QEXP_SIM_BIN) $(QEXP_UB_BIN) $(QUERY_GRAPH_BIN) $(CON_QEXP_BIN) $(NEG_FB_BIN) $(FEAT_EXT_BIN) $(RANK_EXP_BIN) $(RET_NOTOP_BIN) $(CON_PF_BIN) $(GRAPH_TEST_BIN)

$(QEXP_SIM_BIN): $(QEXP_SIM_OBJS)
	$(CXX) $(CXXFLAGS) -o $@ $^ $(CXXLIBS)
	
$(QEXP_UB_BIN): $(QEXP_UB_OBJS)
	$(CXX) $(CXXFLAGS) -o $@ $^ $(CXXLIBS)
	
$(QUERY_GRAPH_BIN): $(QUERY_GRAPH_OBJS)
	$(CXX) $(CXXFLAGS) -o $@ $^ $(CXXLIBS)

$(CON_QEXP_BIN): $(CON_QEXP_OBJS)
	$(CXX) $(CXXFLAGS) -o $@ $^ $(CXXLIBS)

$(NEG_FB_BIN): $(NEG_FB_OBJS)
	$(CXX) $(CXXFLAGS) -o $@ $^ $(CXXLIBS)

$(FEAT_EXT_BIN): $(FEAT_EXT_OBJS)
	$(CXX) $(CXXFLAGS) -o $@ $^ $(CXXLIBS)
	
$(RANK_EXP_BIN): $(RANK_EXP_OBJS)
	$(CXX) $(CXXFLAGS) -o $@ $^ $(CXXLIBS)
	
$(RET_NOTOP_BIN): $(RET_NOTOP_OBJS)
	$(CXX) $(CXXFLAGS) -o $@ $^ $(CXXLIBS)
	
$(CON_PF_BIN): $(CON_PF_OBJS)
	$(CXX) $(CXXFLAGS) -o $@ $^ $(CXXLIBS)
	
$(GRAPH_TEST_BIN): $(GRAPH_TEST_OBJS)
	$(CXX) $(CXXFLAGS) -o $@ $^ 
	
clean:
	rm -f $(QEXP_SIM_BIN) $(QEXP_SIM_OBJS) $(QEXP_UB_BIN) $(QEXP_UB_OBJ) $(QUERY_GRAPH_BIN) $(QUERY_GRAPH_OBJS) $(CON_QEXP_BIN) $(CON_QEXP_OBJS) $(NEG_FB_BIN) $(NEG_FB_OBJS) $(FEAT_EXT_BIN) $(FEAT_EXT_OBJS) $(RANK_EXP_BIN) $(RANK_EXP_OBJS) $(RET_NOTOP_BIN) $(RET_NOTOP_OBJS) $(CON_PF_BIN) $(CON_PF_OBJS) $(GRAPH_TEST_BIN) $(GRAPH_TEST_OBJS)